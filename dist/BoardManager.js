"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _constance = require("./providers/constance");

var _khmerChess = require("khmer-chess");

var _BoardManagerEventController = _interopRequireDefault(require("./event/BoardManagerEventController"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

var BoardManager = /*#__PURE__*/function () {
  function BoardManager() {
    _classCallCheck(this, BoardManager);

    _defineProperty(this, "_cellManagers", []);

    _defineProperty(this, "options", void 0);

    _defineProperty(this, "khmerChessBoard", void 0);

    _defineProperty(this, "khmerChess", void 0);

    _defineProperty(this, "isUpsideDown", false);

    _defineProperty(this, "boardEventController", void 0);

    this.boardEventController = new _BoardManagerEventController["default"]();
  }

  _createClass(BoardManager, [{
    key: "setProps",
    value: function setProps(khmerChessBoard) {
      this.khmerChessBoard = khmerChessBoard;
      this.khmerChess = khmerChessBoard.khmerChess;
      this.options = khmerChessBoard.options;
    }
  }, {
    key: "selectCell",
    value: function selectCell(cell) {
      this.boardEventController.click(cell);
      var selectedList = this.selectedCells;
      var selectedCell = selectedList[0];

      if (selectedCell) {
        if (cell === selectedCell) {
          cell.select(false);
          return this.boardEventController.deselected(selectedCell);
        } else {
          if (cell.isCanMove) {
            return this.boardEventController.attemptMove(selectedCell, cell);
          }
        }
      }

      if (cell.isCanSelect) {
        if (selectedCell) {
          selectedCell.select(false);
          this.boardEventController.deselected(selectedCell);
        }

        cell.select(true);
        return this.boardEventController.selected(cell);
      }
    }
  }, {
    key: "enableClick",
    value: function enableClick() {
      var _this = this;

      this._cellManagers.forEach(function (cell) {
        return cell.setOnClick(_this.selectCell.bind(_this, cell));
      });
    }
  }, {
    key: "push",
    value: function push(i, cell) {
      this._cellManagers[i] = cell;
      cell.setProps(this.khmerChessBoard);
    }
  }, {
    key: "get",
    value: function get(index) {
      var filtered = this._cellManagers.filter(function (cell) {
        return cell.point.index === index;
      });

      return filtered[0];
    }
  }, {
    key: "getKing",
    value: function getKing(color) {
      var filtered = this._cellManagers.filter(function (cell) {
        return cell.piece && cell.piece.isTypeKing && cell.piece.color === color;
      });

      return filtered[0];
    }
  }, {
    key: "getByIndexCode",
    value: function getByIndexCode(indexCode) {
      var index = _khmerChess.Point.indexCodeToIndex(indexCode);

      return this.get(index);
    }
  }, {
    key: "getByXY",
    value: function getByXY(x, y) {
      var index = _khmerChess.Point.xyToIndex(x, y);

      return this.get(index);
    }
  }, {
    key: "flip",
    value: function flip() {
      var _this2 = this;

      this.isUpsideDown = !this.isUpsideDown; // backup

      var backupPiecesList = this._cellManagers.map(function (cell) {
        return cell.clone();
      });

      var backupSelectedList = this.selectedCells.map(function (cell) {
        return cell.clone();
      }); // clear

      this.clearSelectedCells();
      this.removePiecesFromCells(); // flip

      this.applyFlippingFlag(); // restore

      backupPiecesList.forEach(function (clonedCell) {
        var cell = _this2.getByXY(clonedCell.point.x, clonedCell.point.y);

        cell.setPiece(clonedCell.piece);
      });
      backupSelectedList.forEach(function (clonedCell) {
        var cell = _this2.getByXY(clonedCell.point.x, clonedCell.point.y);

        cell.select(true);
      });
    }
  }, {
    key: "pieceCells",
    get: function get() {
      return this._cellManagers.filter(function (cell) {
        return cell.piece;
      });
    }
  }, {
    key: "pieceInTurnCells",
    get: function get() {
      var turn = this.khmerChess.turn;
      return this._cellManagers.filter(function (cell) {
        return cell.piece && cell.piece.color === turn;
      });
    }
  }, {
    key: "pieceNotInTurnCells",
    get: function get() {
      var turn = this.khmerChess.turn;
      return this._cellManagers.filter(function (cell) {
        return cell.piece && cell.piece.color !== turn;
      });
    }
  }, {
    key: "selectedCells",
    get: function get() {
      return this._cellManagers.filter(function (cell) {
        return cell.isSelected;
      });
    }
  }, {
    key: "canMoveCells",
    get: function get() {
      return this._cellManagers.filter(function (cell) {
        return cell.isCanMove;
      });
    }
  }, {
    key: "movedCells",
    get: function get() {
      return this._cellManagers.filter(function (cell) {
        return cell.isMoved;
      });
    }
  }, {
    key: "attackedCells",
    get: function get() {
      return this._cellManagers.filter(function (cell) {
        return cell.isAttacked;
      });
    }
  }, {
    key: "turnCells",
    get: function get() {
      return this._cellManagers.filter(function (cell) {
        return cell.isTurn;
      });
    }
  }, {
    key: "clearSelectedCells",
    value: function clearSelectedCells() {
      var _this3 = this;

      this.selectedCells.forEach(function (cell) {
        cell.select(false);

        _this3.boardEventController.deselected(cell);
      });
    }
  }, {
    key: "clearCanMoveCells",
    value: function clearCanMoveCells() {
      this.canMoveCells.forEach(function (cell) {
        cell.clearCanMoved();
      });
    }
  }, {
    key: "clearMovedCells",
    value: function clearMovedCells() {
      this.movedCells.forEach(function (cell) {
        cell.clearMoved();
      });
    }
  }, {
    key: "clearAttackCells",
    value: function clearAttackCells() {
      this.attackedCells.forEach(function (cell) {
        cell.attack(false);
      });
    }
  }, {
    key: "clearTurnCells",
    value: function clearTurnCells() {
      this.turnCells.forEach(function (cell) {
        cell.turn(false);
      });
    }
  }, {
    key: "removePiecesFromCells",
    value: function removePiecesFromCells() {
      this._cellManagers.forEach(function (cell) {
        cell.removePiece();
      });
    }
  }, {
    key: "applyFlippingFlag",
    value: function applyFlippingFlag() {
      var _this4 = this;

      this._cellManagers.forEach(function (cell) {
        cell.setFlipped(_this4.isUpsideDown);
      });
    }
  }, {
    key: "setCellNote",
    value: function setCellNote() {
      for (var i = 0; i < _khmerChess.ROW_NUMBER; i++) {
        var cell = this.getByXY(i, 0);
        cell.addClassName("".concat(_constance.BOARD_NOTE_H_PREFIX_CLASS, "-").concat(i + 1));

        if (this.options.isEnglish) {
          cell.addClassName(this.options.enClass);
        }
      }

      for (var j = 0; j < _khmerChess.ROW_NUMBER; j++) {
        var _cell = this.getByXY(0, j);

        _cell.addClassName("".concat(_constance.BOARD_NOTE_V_PREFIX_CLASS, "-").concat(j + 1));

        if (this.options.isEnglish) {
          _cell.addClassName(this.options.enClass);
        }
      }
    }
  }, {
    key: "clearCellNote",
    value: function clearCellNote() {
      for (var i = 0; i < _khmerChess.ROW_NUMBER; i++) {
        var cell = this.getByXY(i, 0);
        cell.removeClassName("".concat(_constance.BOARD_NOTE_H_PREFIX_CLASS, "-").concat(i + 1));
        cell.removeClassName(this.options.enClass);
      }

      for (var j = 0; j < _khmerChess.ROW_NUMBER; j++) {
        var _cell2 = this.getByXY(0, j);

        _cell2.removeClassName("".concat(_constance.BOARD_NOTE_V_PREFIX_CLASS, "-").concat(j + 1));

        _cell2.removeClassName(this.options.enClass);
      }
    }
  }, {
    key: "renderKhmerChessPieces",
    value: function renderKhmerChessPieces() {
      var _this5 = this;

      this.removePiecesFromCells();
      this.khmerChess.piecesInBoard.forEach(function (piece, i) {
        var cell = _this5.get(i);

        cell.setPiece(piece);
      });
    }
  }, {
    key: "changeTurn",
    value: function changeTurn(turn) {
      this.khmerChess.turn = turn;

      this._cellManagers.forEach(function (cell) {
        cell.turn(false);
      });

      this.pieceInTurnCells.forEach(function (cell) {
        cell.turn(true);
      });
      this.boardEventController.changeTurn();
    }
  }]);

  return BoardManager;
}();
/*
 * Copyright (c) 2021, K4us
 * Author: Raksa Eng <eng.raksa@gmail.com>
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 'AS IS'
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 *
 **/


exports["default"] = BoardManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9Cb2FyZE1hbmFnZXIudHMiXSwibmFtZXMiOlsiQm9hcmRNYW5hZ2VyIiwiYm9hcmRFdmVudENvbnRyb2xsZXIiLCJCb2FyZE1hbmFnZXJFdmVudENvbnRyb2xsZXIiLCJraG1lckNoZXNzQm9hcmQiLCJraG1lckNoZXNzIiwib3B0aW9ucyIsImNlbGwiLCJjbGljayIsInNlbGVjdGVkTGlzdCIsInNlbGVjdGVkQ2VsbHMiLCJzZWxlY3RlZENlbGwiLCJzZWxlY3QiLCJkZXNlbGVjdGVkIiwiaXNDYW5Nb3ZlIiwiYXR0ZW1wdE1vdmUiLCJpc0NhblNlbGVjdCIsInNlbGVjdGVkIiwiX2NlbGxNYW5hZ2VycyIsImZvckVhY2giLCJzZXRPbkNsaWNrIiwic2VsZWN0Q2VsbCIsImJpbmQiLCJpIiwic2V0UHJvcHMiLCJpbmRleCIsImZpbHRlcmVkIiwiZmlsdGVyIiwicG9pbnQiLCJjb2xvciIsInBpZWNlIiwiaXNUeXBlS2luZyIsImluZGV4Q29kZSIsIlBvaW50IiwiaW5kZXhDb2RlVG9JbmRleCIsImdldCIsIngiLCJ5IiwieHlUb0luZGV4IiwiaXNVcHNpZGVEb3duIiwiYmFja3VwUGllY2VzTGlzdCIsIm1hcCIsImNsb25lIiwiYmFja3VwU2VsZWN0ZWRMaXN0IiwiY2xlYXJTZWxlY3RlZENlbGxzIiwicmVtb3ZlUGllY2VzRnJvbUNlbGxzIiwiYXBwbHlGbGlwcGluZ0ZsYWciLCJjbG9uZWRDZWxsIiwiZ2V0QnlYWSIsInNldFBpZWNlIiwidHVybiIsImlzU2VsZWN0ZWQiLCJpc01vdmVkIiwiaXNBdHRhY2tlZCIsImlzVHVybiIsImNhbk1vdmVDZWxscyIsImNsZWFyQ2FuTW92ZWQiLCJtb3ZlZENlbGxzIiwiY2xlYXJNb3ZlZCIsImF0dGFja2VkQ2VsbHMiLCJhdHRhY2siLCJ0dXJuQ2VsbHMiLCJyZW1vdmVQaWVjZSIsInNldEZsaXBwZWQiLCJST1dfTlVNQkVSIiwiYWRkQ2xhc3NOYW1lIiwiQk9BUkRfTk9URV9IX1BSRUZJWF9DTEFTUyIsImlzRW5nbGlzaCIsImVuQ2xhc3MiLCJqIiwiQk9BUkRfTk9URV9WX1BSRUZJWF9DTEFTUyIsInJlbW92ZUNsYXNzTmFtZSIsInBpZWNlc0luQm9hcmQiLCJwaWVjZUluVHVybkNlbGxzIiwiY2hhbmdlVHVybiJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQU9BOztBQUtBOzs7Ozs7Ozs7Ozs7SUFFcUJBLFk7QUFPakIsMEJBQWM7QUFBQTs7QUFBQSwyQ0FOaUIsRUFNakI7O0FBQUE7O0FBQUE7O0FBQUE7O0FBQUEsMENBRkMsS0FFRDs7QUFBQTs7QUFDVixTQUFLQyxvQkFBTCxHQUE0QixJQUFJQyx1Q0FBSixFQUE1QjtBQUNIOzs7O1dBQ0Qsa0JBQVNDLGVBQVQsRUFBMkM7QUFDdkMsV0FBS0EsZUFBTCxHQUF1QkEsZUFBdkI7QUFDQSxXQUFLQyxVQUFMLEdBQWtCRCxlQUFlLENBQUNDLFVBQWxDO0FBQ0EsV0FBS0MsT0FBTCxHQUFlRixlQUFlLENBQUNFLE9BQS9CO0FBQ0g7OztXQUNELG9CQUFXQyxJQUFYLEVBQThCO0FBQzFCLFdBQUtMLG9CQUFMLENBQTBCTSxLQUExQixDQUFnQ0QsSUFBaEM7QUFDQSxVQUFNRSxZQUFZLEdBQUcsS0FBS0MsYUFBMUI7QUFDQSxVQUFNQyxZQUFZLEdBQUdGLFlBQVksQ0FBQyxDQUFELENBQWpDOztBQUNBLFVBQUlFLFlBQUosRUFBa0I7QUFDZCxZQUFJSixJQUFJLEtBQUtJLFlBQWIsRUFBMkI7QUFDdkJKLFVBQUFBLElBQUksQ0FBQ0ssTUFBTCxDQUFZLEtBQVo7QUFDQSxpQkFBTyxLQUFLVixvQkFBTCxDQUEwQlcsVUFBMUIsQ0FBcUNGLFlBQXJDLENBQVA7QUFDSCxTQUhELE1BR087QUFDSCxjQUFJSixJQUFJLENBQUNPLFNBQVQsRUFBb0I7QUFDaEIsbUJBQU8sS0FBS1osb0JBQUwsQ0FBMEJhLFdBQTFCLENBQXNDSixZQUF0QyxFQUFvREosSUFBcEQsQ0FBUDtBQUNIO0FBQ0o7QUFDSjs7QUFDRCxVQUFJQSxJQUFJLENBQUNTLFdBQVQsRUFB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TCxDQUFxQixLQUFLakUsT0FBTCxDQUFhOEQsT0FBbEM7QUFDSDtBQUNKOzs7V0FFRCxrQ0FBeUI7QUFBQTs7QUFDckIsV0FBS3ZCLHFCQUFMO0FBQ0EsV0FBS3hDLFVBQUwsQ0FBZ0JtRSxhQUFoQixDQUE4QnJELE9BQTlCLENBQXNDLFVBQUNXLEtBQUQsRUFBUVAsQ0FBUixFQUFjO0FBQ2hELFlBQU1oQixJQUFJLEdBQUcsTUFBSSxDQUFDNEIsR0FBTCxDQUFTWixDQUFULENBQWI7O0FBQ0FoQixRQUFBQSxJQUFJLENBQUMwQyxRQUFMLENBQWNuQixLQUFkO0FBQ0gsT0FIRDtBQUlIOzs7V0FFRCxvQkFBV29CLElBQVgsRUFBeUI7QUFDckIsV0FBSzdDLFVBQUwsQ0FBZ0I2QyxJQUFoQixHQUF1QkEsSUFBdkI7O0FBQ0EsV0FBS2hDLGFBQUwsQ0FBbUJDLE9BQW5CLENBQTJCLFVBQUNaLElBQUQsRUFBVTtBQUNqQ0EsUUFBQUEsSUFBSSxDQUFDMkMsSUFBTCxDQUFVLEtBQVY7QUFDSCxPQUZEOztBQUdBLFdBQUt1QixnQkFBTCxDQUFzQnRELE9BQXRCLENBQThCLFVBQUNaLElBQUQsRUFBVTtBQUNwQ0EsUUFBQUEsSUFBSSxDQUFDMkMsSUFBTCxDQUFVLElBQVY7QUFDSCxPQUZEO0FBR0EsV0FBS2hELG9CQUFMLENBQTBCd0UsVUFBMUI7QUFDSDs7Ozs7QUFHTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICAgIEJPQVJEX05PVEVfVl9QUkVGSVhfQ0xBU1MsXG4gICAgQk9BUkRfTk9URV9IX1BSRUZJWF9DTEFTUyxcbn0gZnJvbSAnLi9wcm92aWRlcnMvY29uc3RhbmNlJztcbmltcG9ydCBDZWxsTWFuYWdlciBmcm9tICcuL0NlbGxNYW5hZ2VyJztcbmltcG9ydCBPcHRpb25zTWFuYWdlciBmcm9tICcuL09wdGlvbnNNYW5hZ2VyJztcbmltcG9ydCBLaG1lckNoZXNzQm9hcmQgZnJvbSAnLi9LaG1lckNoZXNzQm9hcmQnO1xuaW1wb3J0IHtcbiAgICBLaG1lckNoZXNzLFxuICAgIFBvaW50LFxuICAgIFJPV19OVU1CRVIsXG59IGZyb20gJ2tobWVyLWNoZXNzJztcbmltcG9ydCBCb2FyZE1hbmFnZXJFdmVudENvbnRyb2xsZXIgZnJvbSAnLi9ldmVudC9Cb2FyZE1hbmFnZXJFdmVudENvbnRyb2xsZXInO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBCb2FyZE1hbmFnZXIge1xuICAgIF9jZWxsTWFuYWdlcnM6IENlbGxNYW5hZ2VyW10gPSBbXTtcbiAgICBvcHRpb25zOiBPcHRpb25zTWFuYWdlcjtcbiAgICBraG1lckNoZXNzQm9hcmQ6IEtobWVyQ2hlc3NCb2FyZDtcbiAgICBraG1lckNoZXNzOiBLaG1lckNoZXNzO1xuICAgIGlzVXBzaWRlRG93biA9IGZhbHNlO1xuICAgIGJvYXJkRXZlbnRDb250cm9sbGVyOiBCb2FyZE1hbmFnZXJFdmVudENvbnRyb2xsZXI8Q2VsbE1hbmFnZXI+O1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmJvYXJkRXZlbnRDb250cm9sbGVyID0gbmV3IEJvYXJkTWFuYWdlckV2ZW50Q29udHJvbGxlcigpO1xuICAgIH1cbiAgICBzZXRQcm9wcyhraG1lckNoZXNzQm9hcmQ6IEtobWVyQ2hlc3NCb2FyZCkge1xuICAgICAgICB0aGlzLmtobWVyQ2hlc3NCb2FyZCA9IGtobWVyQ2hlc3NCb2FyZDtcbiAgICAgICAgdGhpcy5raG1lckNoZXNzID0ga2htZXJDaGVzc0JvYXJkLmtobWVyQ2hlc3M7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IGtobWVyQ2hlc3NCb2FyZC5vcHRpb25zO1xuICAgIH1cbiAgICBzZWxlY3RDZWxsKGNlbGw6IENlbGxNYW5hZ2VyKSB7XG4gICAgICAgIHRoaXMuYm9hcmRFdmVudENvbnRyb2xsZXIuY2xpY2soY2VsbCk7XG4gICAgICAgIGNvbnN0IHNlbGVjdGVkTGlzdCA9IHRoaXMuc2VsZWN0ZWRDZWxscztcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRDZWxsID0gc2VsZWN0ZWRMaXN0WzBdO1xuICAgICAgICBpZiAoc2VsZWN0ZWRDZWxsKSB7XG4gICAgICAgICAgICBpZiAoY2VsbCA9PT0gc2VsZWN0ZWRDZWxsKSB7XG4gICAgICAgICAgICAgICAgY2VsbC5zZWxlY3QoZmFsc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmJvYXJkRXZlbnRDb250cm9sbGVyLmRlc2VsZWN0ZWQoc2VsZWN0ZWRDZWxsKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKGNlbGwuaXNDYW5Nb3ZlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmJvYXJkRXZlbnRDb250cm9sbGVyLmF0dGVtcHRNb3ZlKHNlbGVjdGVkQ2VsbCwgY2VsbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChjZWxsLmlzQ2FuU2VsZWN0KSB7XG4gICAgICAgICAgICBpZiAoc2VsZWN0ZWRDZWxsKSB7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRDZWxsLnNlbGVjdChmYWxzZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5ib2FyZEV2ZW50Q29udHJvbGxlci5kZXNlbGVjdGVkKHNlbGVjdGVkQ2VsbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjZWxsLnNlbGVjdCh0cnVlKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmJvYXJkRXZlbnRDb250cm9sbGVyLnNlbGVjdGVkKGNlbGwpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVuYWJsZUNsaWNrKCkge1xuICAgICAgICB0aGlzLl9jZWxsTWFuYWdlcnMuZm9yRWFjaCgoY2VsbCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGNlbGwuc2V0T25DbGljayh0aGlzLnNlbGVjdENlbGwuYmluZCh0aGlzLCBjZWxsKSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1c2goaTogbnVtYmVyLCBjZWxsOiBDZWxsTWFuYWdlcikge1xuICAgICAgICB0aGlzLl9jZWxsTWFuYWdlcnNbaV0gPSBjZWxsO1xuICAgICAgICBjZWxsLnNldFByb3BzKHRoaXMua2htZXJDaGVzc0JvYXJkKTtcbiAgICB9XG5cbiAgICBnZXQoaW5kZXg6IG51bWJlcikge1xuICAgICAgICBjb25zdCBmaWx0ZXJlZCA9IHRoaXMuX2NlbGxNYW5hZ2Vycy5maWx0ZXIoKGNlbGw6IENlbGxNYW5hZ2VyKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gY2VsbC5wb2ludC5pbmRleCA9PT0gaW5kZXg7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gZmlsdGVyZWRbMF07XG4gICAgfVxuICAgIGdldEtpbmcoY29sb3I6IHN0cmluZykge1xuICAgICAgICBjb25zdCBmaWx0ZXJlZCA9IHRoaXMuX2NlbGxNYW5hZ2Vycy5maWx0ZXIoKGNlbGw6IENlbGxNYW5hZ2VyKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gY2VsbC5waWVjZSAmJiBjZWxsLnBpZWNlLmlzVHlwZUtpbmcgJiYgY2VsbC5waWVjZS5jb2xvciA9PT0gY29sb3I7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gZmlsdGVyZWRbMF07XG4gICAgfVxuXG4gICAgZ2V0QnlJbmRleENvZGUoaW5kZXhDb2RlOiBzdHJpbmcpIHtcbiAgICAgICAgY29uc3QgaW5kZXggPSBQb2ludC5pbmRleENvZGVUb0luZGV4KGluZGV4Q29kZSk7XG4gICAgICAgIHJldHVybiB0aGlzLmdldChpbmRleCk7XG4gICAgfVxuXG4gICAgZ2V0QnlYWSh4OiBudW1iZXIsIHk6IG51bWJlcikge1xuICAgICAgICBjb25zdCBpbmRleCA9IFBvaW50Lnh5VG9JbmRleCh4LCB5KTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KGluZGV4KTtcbiAgICB9XG5cbiAgICBmbGlwKCkge1xuICAgICAgICB0aGlzLmlzVXBzaWRlRG93biA9ICF0aGlzLmlzVXBzaWRlRG93bjtcbiAgICAgICAgLy8gYmFja3VwXG4gICAgICAgIGNvbnN0IGJhY2t1cFBpZWNlc0xpc3QgPSB0aGlzLl9jZWxsTWFuYWdlcnMubWFwKChjZWxsKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gY2VsbC5jbG9uZSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgYmFja3VwU2VsZWN0ZWRMaXN0ID0gdGhpcy5zZWxlY3RlZENlbGxzLm1hcCgoY2VsbCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGNlbGwuY2xvbmUoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIGNsZWFyXG4gICAgICAgIHRoaXMuY2xlYXJTZWxlY3RlZENlbGxzKCk7XG4gICAgICAgIHRoaXMucmVtb3ZlUGllY2VzRnJvbUNlbGxzKCk7XG4gICAgICAgIC8vIGZsaXBcbiAgICAgICAgdGhpcy5hcHBseUZsaXBwaW5nRmxhZygpO1xuICAgICAgICAvLyByZXN0b3JlXG4gICAgICAgIGJhY2t1cFBpZWNlc0xpc3QuZm9yRWFjaCgoY2xvbmVkQ2VsbCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY2VsbCA9IHRoaXMuZ2V0QnlYWShjbG9uZWRDZWxsLnBvaW50LngsIGNsb25lZENlbGwucG9pbnQueSk7XG4gICAgICAgICAgICBjZWxsLnNldFBpZWNlKGNsb25lZENlbGwucGllY2UpO1xuICAgICAgICB9KTtcbiAgICAgICAgYmFja3VwU2VsZWN0ZWRMaXN0LmZvckVhY2goKGNsb25lZENlbGwpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNlbGwgPSB0aGlzLmdldEJ5WFkoY2xvbmVkQ2VsbC5wb2ludC54LCBjbG9uZWRDZWxsLnBvaW50LnkpO1xuICAgICAgICAgICAgY2VsbC5zZWxlY3QodHJ1ZSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGdldCBwaWVjZUNlbGxzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fY2VsbE1hbmFnZXJzLmZpbHRlcigoY2VsbCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGNlbGwucGllY2U7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBnZXQgcGllY2VJblR1cm5DZWxscygpIHtcbiAgICAgICAgY29uc3QgdHVybiA9IHRoaXMua2htZXJDaGVzcy50dXJuO1xuICAgICAgICByZXR1cm4gdGhpcy5fY2VsbE1hbmFnZXJzLmZpbHRlcigoY2VsbCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGNlbGwucGllY2UgJiYgY2VsbC5waWVjZS5jb2xvciA9PT0gdHVybjtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGdldCBwaWVjZU5vdEluVHVybkNlbGxzKCkge1xuICAgICAgICBjb25zdCB0dXJuID0gdGhpcy5raG1lckNoZXNzLnR1cm47XG4gICAgICAgIHJldHVybiB0aGlzLl9jZWxsTWFuYWdlcnMuZmlsdGVyKChjZWxsKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gY2VsbC5waWVjZSAmJiBjZWxsLnBpZWNlLmNvbG9yICE9PSB0dXJuO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZ2V0IHNlbGVjdGVkQ2VsbHMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jZWxsTWFuYWdlcnMuZmlsdGVyKChjZWxsKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gY2VsbC5pc1NlbGVjdGVkO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZ2V0IGNhbk1vdmVDZWxscygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NlbGxNYW5hZ2Vycy5maWx0ZXIoKGNlbGwpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBjZWxsLmlzQ2FuTW92ZTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGdldCBtb3ZlZENlbGxzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fY2VsbE1hbmFnZXJzLmZpbHRlcigoY2VsbCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGNlbGwuaXNNb3ZlZDtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGdldCBhdHRhY2tlZENlbGxzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fY2VsbE1hbmFnZXJzLmZpbHRlcigoY2VsbCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGNlbGwuaXNBdHRhY2tlZDtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGdldCB0dXJuQ2VsbHMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jZWxsTWFuYWdlcnMuZmlsdGVyKChjZWxsKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gY2VsbC5pc1R1cm47XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGNsZWFyU2VsZWN0ZWRDZWxscygpIHtcbiAgICAgICAgdGhpcy5zZWxlY3RlZENlbGxzLmZvckVhY2goKGNlbGwpID0+IHtcbiAgICAgICAgICAgIGNlbGwuc2VsZWN0KGZhbHNlKTtcbiAgICAgICAgICAgIHRoaXMuYm9hcmRFdmVudENvbnRyb2xsZXIuZGVzZWxlY3RlZChjZWxsKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGNsZWFyQ2FuTW92ZUNlbGxzKCkge1xuICAgICAgICB0aGlzLmNhbk1vdmVDZWxscy5mb3JFYWNoKChjZWxsKSA9PiB7XG4gICAgICAgICAgICBjZWxsLmNsZWFyQ2FuTW92ZWQoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgY2xlYXJNb3ZlZENlbGxzKCkge1xuICAgICAgICB0aGlzLm1vdmVkQ2VsbHMuZm9yRWFjaCgoY2VsbCkgPT4ge1xuICAgICAgICAgICAgY2VsbC5jbGVhck1vdmVkKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGNsZWFyQXR0YWNrQ2VsbHMoKSB7XG4gICAgICAgIHRoaXMuYXR0YWNrZWRDZWxscy5mb3JFYWNoKChjZWxsKSA9PiB7XG4gICAgICAgICAgICBjZWxsLmF0dGFjayhmYWxzZSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGNsZWFyVHVybkNlbGxzKCkge1xuICAgICAgICB0aGlzLnR1cm5DZWxscy5mb3JFYWNoKChjZWxsKSA9PiB7XG4gICAgICAgICAgICBjZWxsLnR1cm4oZmFsc2UpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICByZW1vdmVQaWVjZXNGcm9tQ2VsbHMoKSB7XG4gICAgICAgIHRoaXMuX2NlbGxNYW5hZ2Vycy5mb3JFYWNoKChjZWxsKSA9PiB7XG4gICAgICAgICAgICBjZWxsLnJlbW92ZVBpZWNlKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGFwcGx5RmxpcHBpbmdGbGFnKCkge1xuICAgICAgICB0aGlzLl9jZWxsTWFuYWdlcnMuZm9yRWFjaCgoY2VsbCkgPT4ge1xuICAgICAgICAgICAgY2VsbC5zZXRGbGlwcGVkKHRoaXMuaXNVcHNpZGVEb3duKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgc2V0Q2VsbE5vdGUoKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgUk9XX05VTUJFUjsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBjZWxsID0gdGhpcy5nZXRCeVhZKGksIDApO1xuICAgICAgICAgICAgY2VsbC5hZGRDbGFzc05hbWUoYCR7Qk9BUkRfTk9URV9IX1BSRUZJWF9DTEFTU30tJHtpICsgMX1gKTtcbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuaXNFbmdsaXNoKSB7XG4gICAgICAgICAgICAgICAgY2VsbC5hZGRDbGFzc05hbWUodGhpcy5vcHRpb25zLmVuQ2xhc3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgUk9XX05VTUJFUjsgaisrKSB7XG4gICAgICAgICAgICBjb25zdCBjZWxsID0gdGhpcy5nZXRCeVhZKDAsIGopO1xuICAgICAgICAgICAgY2VsbC5hZGRDbGFzc05hbWUoYCR7Qk9BUkRfTk9URV9WX1BSRUZJWF9DTEFTU30tJHtqICsgMX1gKTtcbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuaXNFbmdsaXNoKSB7XG4gICAgICAgICAgICAgICAgY2VsbC5hZGRDbGFzc05hbWUodGhpcy5vcHRpb25zLmVuQ2xhc3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGNsZWFyQ2VsbE5vdGUoKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgUk9XX05VTUJFUjsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBjZWxsID0gdGhpcy5nZXRCeVhZKGksIDApO1xuICAgICAgICAgICAgY2VsbC5yZW1vdmVDbGFzc05hbWUoYCR7Qk9BUkRfTk9URV9IX1BSRUZJWF9DTEFTU30tJHtpICsgMX1gKTtcbiAgICAgICAgICAgIGNlbGwucmVtb3ZlQ2xhc3NOYW1lKHRoaXMub3B0aW9ucy5lbkNsYXNzKTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IFJPV19OVU1CRVI7IGorKykge1xuICAgICAgICAgICAgY29uc3QgY2VsbCA9IHRoaXMuZ2V0QnlYWSgwLCBqKTtcbiAgICAgICAgICAgIGNlbGwucmVtb3ZlQ2xhc3NOYW1lKGAke0JPQVJEX05PVEVfVl9QUkVGSVhfQ0xBU1N9LSR7aiArIDF9YCk7XG4gICAgICAgICAgICBjZWxsLnJlbW92ZUNsYXNzTmFtZSh0aGlzLm9wdGlvbnMuZW5DbGFzcyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZW5kZXJLaG1lckNoZXNzUGllY2VzKCkge1xuICAgICAgICB0aGlzLnJlbW92ZVBpZWNlc0Zyb21DZWxscygpO1xuICAgICAgICB0aGlzLmtobWVyQ2hlc3MucGllY2VzSW5Cb2FyZC5mb3JFYWNoKChwaWVjZSwgaSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY2VsbCA9IHRoaXMuZ2V0KGkpO1xuICAgICAgICAgICAgY2VsbC5zZXRQaWVjZShwaWVjZSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGNoYW5nZVR1cm4odHVybjogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMua2htZXJDaGVzcy50dXJuID0gdHVybjtcbiAgICAgICAgdGhpcy5fY2VsbE1hbmFnZXJzLmZvckVhY2goKGNlbGwpID0+IHtcbiAgICAgICAgICAgIGNlbGwudHVybihmYWxzZSk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnBpZWNlSW5UdXJuQ2VsbHMuZm9yRWFjaCgoY2VsbCkgPT4ge1xuICAgICAgICAgICAgY2VsbC50dXJuKHRydWUpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5ib2FyZEV2ZW50Q29udHJvbGxlci5jaGFuZ2VUdXJuKCk7XG4gICAgfVxufVxuXG4vKlxuICogQ29weXJpZ2h0IChjKSAyMDIxLCBLNHVzXG4gKiBBdXRob3I6IFJha3NhIEVuZyA8ZW5nLnJha3NhQGdtYWlsLmNvbT5cbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0XG4gKiBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMgYXJlIG1ldDpcbiAqXG4gKiAxLiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsXG4gKiAgICB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyLlxuICogMi4gUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLFxuICogICAgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGUgZG9jdW1lbnRhdGlvblxuICogICAgYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uXG4gKlxuICogVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCBCWSBUSEUgQ09QWVJJR0hUIEhPTERFUlMgQU5EIENPTlRSSUJVVE9SUyAnQVMgSVMnXG4gKiBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFXG4gKiBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRVxuICogQVJFIERJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBDT1BZUklHSFQgT1dORVIgT1IgQ09OVFJJQlVUT1JTIEJFXG4gKiBMSUFCTEUgRk9SIEFOWSBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SXG4gKiBDT05TRVFVRU5USUFMIERBTUFHRVMgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRlxuICogU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUzsgTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTXG4gKiBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORCBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTlxuICogQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlQgKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSlcbiAqIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFXG4gKiBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS5cbiAqXG4gKiovIl19