"use strict";

var _KhmerChessBoard = _interopRequireDefault(require("./KhmerChessBoard"));

var _khmerChess = require("khmer-chess");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

describe("KhmerChessBoard", function () {
  var kcb = null;
  beforeAll(function () {
    var container = document.createElement("div");
    document.body.appendChild(container);
    kcb = new _KhmerChessBoard["default"]();
    kcb.setOptions({
      width: 600,
      container: container
    });
    kcb.start();
  });
  it('should return correct cell', function () {
    var cell = kcb.boardManager.get(0);
    expect(cell.point.indexCode).toEqual('a1');
  });
  it('should be valid selection', function () {
    var cell = kcb.boardManager.pieceNotInTurnCells[0];
    kcb.boardManager.selectCell(cell);
    expect(cell.isSelected).toBeFalse();
  });
  it('should make correct selected', function () {
    var cell = kcb.boardManager.pieceInTurnCells[0];
    kcb.boardManager.selectCell(cell);
    expect(cell.isSelected).toBeTrue(); // second selection to clear

    kcb.boardManager.selectCell(cell);
    expect(cell.isSelected).toBeFalse();
  });
  it('should select another one', function () {
    var cell1 = kcb.boardManager.pieceInTurnCells[0];
    var cell2 = kcb.boardManager.pieceInTurnCells[2];
    kcb.boardManager.selectCell(cell1);
    kcb.boardManager.selectCell(cell2);
    expect(cell1.isSelected).toBeFalse();
    expect(cell2.isSelected).toBeTrue();
  });
  it('should return king', function () {
    var cell = kcb.boardManager.getKing(_KhmerChessBoard["default"].PIECE_COLOR_BLACK);
    expect(cell.piece.isColorBlack).toBeTrue();
    expect(cell.piece.isTypeKing).toBeTrue();
    cell = kcb.boardManager.getKing(_KhmerChessBoard["default"].PIECE_COLOR_WHITE);
    expect(cell.piece.isColorWhite).toBeTrue();
    expect(cell.piece.isTypeKing).toBeTrue();
  });
  it('should return by index code', function () {
    var point = new _khmerChess.Point(0, 0);
    var cell = kcb.boardManager.getByIndexCode(point.indexCode);
    expect(cell.point.indexCode).toBe(point.indexCode);
  });
  it('should return by x,y', function () {
    var point = new _khmerChess.Point(0, 0);
    var cell = kcb.boardManager.getByXY(point.x, point.y);
    expect(cell.point.indexCode).toBe(point.indexCode);
  });
  it('should flip', function () {
    // TODO: test all possible flip features
    var cell0 = kcb.boardManager.get(0);
    var cell = kcb.boardManager.pieceInTurnCells[0];
    var index = cell.point.index;
    kcb.boardManager.selectCell(cell);
    expect(cell0.point.indexCode).toBe('a1');
    kcb.boardManager.flip();
    expect(cell0.point.indexCode).toBe('h8');
    expect(cell.point.index).toBe(_khmerChess.CELL_COUNT - index - 1); // turn back

    kcb.boardManager.selectCell(cell);
    kcb.boardManager.flip();
    expect(cell0.point.indexCode).toBe('a1');
    expect(cell.point.index).toBe(index);
  });
  it('should return all cells that has piece', function () {
    var cells = kcb.boardManager.pieceCells;
    expect(cells.length).toBe(32);
  });
  it('should move', function () {
    kcb.pieceShadowManager.quickMove = true;
    var cell = kcb.boardManager.pieceInTurnCells[0];
    var piece = cell.piece;
    var point = cell.canMovePoints[0];
    var targetCell = kcb.boardManager.get(point.index);
    kcb.move(cell.point.index, targetCell.point.index);
    var movedCells = kcb.boardManager.movedCells;
    expect(movedCells[1].piece).toBe(piece);
  });
});
/*
 * Copyright (c) 2021, K4us
 * Author: Raksa Eng <eng.raksa@gmail.com>
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 'AS IS'
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 *
 **/
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9Cb2FyZE1hbmFnZXIuU3BlYy50cyJdLCJuYW1lcyI6WyJkZXNjcmliZSIsImtjYiIsImJlZm9yZUFsbCIsImNvbnRhaW5lciIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImJvZHkiLCJhcHBlbmRDaGlsZCIsIktobWVyQ2hlc3NCb2FyZCIsInNldE9wdGlvbnMiLCJ3aWR0aCIsInN0YXJ0IiwiaXQiLCJjZWxsIiwiYm9hcmRNYW5hZ2VyIiwiZ2V0IiwiZXhwZWN0IiwicG9pbnQiLCJpbmRleENvZGUiLCJ0b0VxdWFsIiwicGllY2VOb3RJblR1cm5DZWxscyIsInNlbGVjdENlbGwiLCJpc1NlbGVjdGVkIiwidG9CZUZhbHNlIiwicGllY2VJblR1cm5DZWxscyIsInRvQmVUcnVlIiwiY2VsbDEiLCJjZWxsMiIsImdldEtpbmciLCJQSUVDRV9DT0xPUl9CTEFDSyIsInBpZWNlIiwiaXNDb2xvckJsYWNrIiwiaXNUeXBlS2luZyIsIlBJRUNFX0NPTE9SX1dISVRFIiwiaXNDb2xvcldoaXRlIiwiUG9pbnQiLCJnZXRCeUluZGV4Q29kZSIsInRvQmUiLCJnZXRCeVhZIiwieCIsInkiLCJjZWxsMCIsImluZGV4IiwiZmxpcCIsIkNFTExfQ09VTlQiLCJjZWxscyIsInBpZWNlQ2VsbHMiLCJsZW5ndGgiLCJwaWVjZVNoYWRvd01hbmFnZXIiLCJxdWlja01vdmUiLCJjYW5Nb3ZlUG9pbnRzIiwidGFyZ2V0Q2VsbCIsIm1vdmUiLCJtb3ZlZENlbGxzIl0sIm1hcHBpbmdzIjoiOztBQUFBOztBQUNBOzs7O0FBRUFBLFFBQVEsQ0FBQyxpQkFBRCxFQUFvQixZQUFZO0FBQ3BDLE1BQUlDLEdBQW9CLEdBQUcsSUFBM0I7QUFFQUMsRUFBQUEsU0FBUyxDQUFDLFlBQU07QUFDWixRQUFNQyxTQUFTLEdBQUdDLFFBQVEsQ0FBQ0MsYUFBVCxDQUF1QixLQUF2QixDQUFsQjtBQUNBRCxJQUFBQSxRQUFRLENBQUNFLElBQVQsQ0FBY0MsV0FBZCxDQUEwQkosU0FB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QUFELEVBQWdCLFlBQU07QUFDcEJYLElBQUFBLEdBQUcsQ0FBQytDLGtCQUFKLENBQXVCQyxTQUF2QixHQUFtQyxJQUFuQztBQUNBLFFBQU1wQyxJQUFJLEdBQUdaLEdBQUcsQ0FBQ2EsWUFBSixDQUFpQlUsZ0JBQWpCLENBQWtDLENBQWxDLENBQWI7QUFDQSxRQUFNTSxLQUFLLEdBQUdqQixJQUFJLENBQUNpQixLQUFuQjtBQUNBLFFBQU1iLEtBQUssR0FBR0osSUFBSSxDQUFDcUMsYUFBTCxDQUFtQixDQUFuQixDQUFkO0FBQ0EsUUFBTUMsVUFBVSxHQUFHbEQsR0FBRyxDQUFDYSxZQUFKLENBQWlCQyxHQUFqQixDQUFxQkUsS0FBSyxDQUFDeUIsS0FBM0IsQ0FBbkI7QUFDQXpDLElBQUFBLEdBQUcsQ0FBQ21ELElBQUosQ0FBU3ZDLElBQUksQ0FBQ0ksS0FBTCxDQUFXeUIsS0FBcEIsRUFBMkJTLFVBQVUsQ0FBQ2xDLEtBQVgsQ0FBaUJ5QixLQUE1QztBQUNBLFFBQU1XLFVBQVUsR0FBR3BELEdBQUcsQ0FBQ2EsWUFBSixDQUFpQnVDLFVBQXBDO0FBQ0FyQyxJQUFBQSxNQUFNLENBQUNxQyxVQUFVLENBQUMsQ0FBRCxDQUFWLENBQWN2QixLQUFmLENBQU4sQ0FBNEJPLElBQTVCLENBQWlDUCxLQUFqQztBQUNILEdBVEMsQ0FBRjtBQVVILENBaEdPLENBQVI7QUFrR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEtobWVyQ2hlc3NCb2FyZCBmcm9tIFwiLi9LaG1lckNoZXNzQm9hcmRcIjtcbmltcG9ydCB7IFBvaW50LCBDRUxMX0NPVU5UIH0gZnJvbSBcImtobWVyLWNoZXNzXCI7XG5cbmRlc2NyaWJlKFwiS2htZXJDaGVzc0JvYXJkXCIsIGZ1bmN0aW9uICgpIHtcbiAgICBsZXQga2NiOiBLaG1lckNoZXNzQm9hcmQgPSBudWxsO1xuXG4gICAgYmVmb3JlQWxsKCgpID0+IHtcbiAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjb250YWluZXIpO1xuICAgICAgICBrY2IgPSBuZXcgS2htZXJDaGVzc0JvYXJkKCk7XG4gICAgICAgIGtjYi5zZXRPcHRpb25zKHtcbiAgICAgICAgICAgIHdpZHRoOiA2MDAsXG4gICAgICAgICAgICBjb250YWluZXJcbiAgICAgICAgfSk7XG4gICAgICAgIGtjYi5zdGFydCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gY29ycmVjdCBjZWxsJywgKCkgPT4ge1xuICAgICAgICBjb25zdCBjZWxsID0ga2NiLmJvYXJkTWFuYWdlci5nZXQoMCk7XG4gICAgICAgIGV4cGVjdChjZWxsLnBvaW50LmluZGV4Q29kZSkudG9FcXVhbCgnYTEnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYmUgdmFsaWQgc2VsZWN0aW9uJywgKCkgPT4ge1xuICAgICAgICBjb25zdCBjZWxsID0ga2NiLmJvYXJkTWFuYWdlci5waWVjZU5vdEluVHVybkNlbGxzWzBdO1xuICAgICAgICBrY2IuYm9hcmRNYW5hZ2VyLnNlbGVjdENlbGwoY2VsbCk7XG4gICAgICAgIGV4cGVjdChjZWxsLmlzU2VsZWN0ZWQpLnRvQmVGYWxzZSgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBtYWtlIGNvcnJlY3Qgc2VsZWN0ZWQnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGNlbGwgPSBrY2IuYm9hcmRNYW5hZ2VyLnBpZWNlSW5UdXJuQ2VsbHNbMF07XG4gICAgICAgIGtjYi5ib2FyZE1hbmFnZXIuc2VsZWN0Q2VsbChjZWxsKTtcbiAgICAgICAgZXhwZWN0KGNlbGwuaXNTZWxlY3RlZCkudG9CZVRydWUoKTtcbiAgICAgICAgLy8gc2Vjb25kIHNlbGVjdGlvbiB0byBjbGVhclxuICAgICAgICBrY2IuYm9hcmRNYW5hZ2VyLnNlbGVjdENlbGwoY2VsbCk7XG4gICAgICAgIGV4cGVjdChjZWxsLmlzU2VsZWN0ZWQpLnRvQmVGYWxzZSgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBzZWxlY3QgYW5vdGhlciBvbmUnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGNlbGwxID0ga2NiLmJvYXJkTWFuYWdlci5waWVjZUluVHVybkNlbGxzWzBdO1xuICAgICAgICBjb25zdCBjZWxsMiA9IGtjYi5ib2FyZE1hbmFnZXIucGllY2VJblR1cm5DZWxsc1syXTtcbiAgICAgICAga2NiLmJvYXJkTWFuYWdlci5zZWxlY3RDZWxsKGNlbGwxKTtcbiAgICAgICAga2NiLmJvYXJkTWFuYWdlci5zZWxlY3RDZWxsKGNlbGwyKTtcbiAgICAgICAgZXhwZWN0KGNlbGwxLmlzU2VsZWN0ZWQpLnRvQmVGYWxzZSgpO1xuICAgICAgICBleHBlY3QoY2VsbDIuaXNTZWxlY3RlZCkudG9CZVRydWUoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGtpbmcnLCAoKSA9PiB7XG4gICAgICAgIGxldCBjZWxsID0ga2NiLmJvYXJkTWFuYWdlci5nZXRLaW5nKEtobWVyQ2hlc3NCb2FyZC5QSUVDRV9DT0xPUl9CTEFDSyk7XG4gICAgICAgIGV4cGVjdChjZWxsLnBpZWNlLmlzQ29sb3JCbGFjaykudG9CZVRydWUoKTtcbiAgICAgICAgZXhwZWN0KGNlbGwucGllY2UuaXNUeXBlS2luZykudG9CZVRydWUoKTtcbiAgICAgICAgY2VsbCA9IGtjYi5ib2FyZE1hbmFnZXIuZ2V0S2luZyhLaG1lckNoZXNzQm9hcmQuUElFQ0VfQ09MT1JfV0hJVEUpO1xuICAgICAgICBleHBlY3QoY2VsbC5waWVjZS5pc0NvbG9yV2hpdGUpLnRvQmVUcnVlKCk7XG4gICAgICAgIGV4cGVjdChjZWxsLnBpZWNlLmlzVHlwZUtpbmcpLnRvQmVUcnVlKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBieSBpbmRleCBjb2RlJywgKCkgPT4ge1xuICAgICAgICBjb25zdCBwb2ludCA9IG5ldyBQb2ludCgwLCAwKTtcbiAgICAgICAgY29uc3QgY2VsbCA9IGtjYi5ib2FyZE1hbmFnZXIuZ2V0QnlJbmRleENvZGUocG9pbnQuaW5kZXhDb2RlKTtcbiAgICAgICAgZXhwZWN0KGNlbGwucG9pbnQuaW5kZXhDb2RlKS50b0JlKHBvaW50LmluZGV4Q29kZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBieSB4LHknLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHBvaW50ID0gbmV3IFBvaW50KDAsIDApO1xuICAgICAgICBjb25zdCBjZWxsID0ga2NiLmJvYXJkTWFuYWdlci5nZXRCeVhZKHBvaW50LngsIHBvaW50LnkpO1xuICAgICAgICBleHBlY3QoY2VsbC5wb2ludC5pbmRleENvZGUpLnRvQmUocG9pbnQuaW5kZXhDb2RlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZmxpcCcsICgpID0+IHtcbiAgICAgICAgLy8gVE9ETzogdGVzdCBhbGwgcG9zc2libGUgZmxpcCBmZWF0dXJlc1xuICAgICAgICBjb25zdCBjZWxsMCA9IGtjYi5ib2FyZE1hbmFnZXIuZ2V0KDApO1xuICAgICAgICBjb25zdCBjZWxsID0ga2NiLmJvYXJkTWFuYWdlci5waWVjZUluVHVybkNlbGxzWzBdO1xuICAgICAgICBjb25zdCBpbmRleCA9IGNlbGwucG9pbnQuaW5kZXg7XG4gICAgICAgIGtjYi5ib2FyZE1hbmFnZXIuc2VsZWN0Q2VsbChjZWxsKTtcbiAgICAgICAgZXhwZWN0KGNlbGwwLnBvaW50LmluZGV4Q29kZSkudG9CZSgnYTEnKTtcbiAgICAgICAga2NiLmJvYXJkTWFuYWdlci5mbGlwKCk7XG4gICAgICAgIGV4cGVjdChjZWxsMC5wb2ludC5pbmRleENvZGUpLnRvQmUoJ2g4Jyk7XG4gICAgICAgIGV4cGVjdChjZWxsLnBvaW50LmluZGV4KS50b0JlKENFTExfQ09VTlQgLSBpbmRleCAtIDEpO1xuICAgICAgICAvLyB0dXJuIGJhY2tcbiAgICAgICAga2NiLmJvYXJkTWFuYWdlci5zZWxlY3RDZWxsKGNlbGwpO1xuICAgICAgICBrY2IuYm9hcmRNYW5hZ2VyLmZsaXAoKTtcbiAgICAgICAgZXhwZWN0KGNlbGwwLnBvaW50LmluZGV4Q29kZSkudG9CZSgnYTEnKTtcbiAgICAgICAgZXhwZWN0KGNlbGwucG9pbnQuaW5kZXgpLnRvQmUoaW5kZXgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gYWxsIGNlbGxzIHRoYXQgaGFzIHBpZWNlJywgKCkgPT4ge1xuICAgICAgICBjb25zdCBjZWxscyA9IGtjYi5ib2FyZE1hbmFnZXIucGllY2VDZWxscztcbiAgICAgICAgZXhwZWN0KGNlbGxzLmxlbmd0aCkudG9CZSgzMik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG1vdmUnLCAoKSA9PiB7XG4gICAgICAgIGtjYi5waWVjZVNoYWRvd01hbmFnZXIucXVpY2tNb3ZlID0gdHJ1ZTtcbiAgICAgICAgY29uc3QgY2VsbCA9IGtjYi5ib2FyZE1hbmFnZXIucGllY2VJblR1cm5DZWxsc1swXTtcbiAgICAgICAgY29uc3QgcGllY2UgPSBjZWxsLnBpZWNlO1xuICAgICAgICBjb25zdCBwb2ludCA9IGNlbGwuY2FuTW92ZVBvaW50c1swXTtcbiAgICAgICAgY29uc3QgdGFyZ2V0Q2VsbCA9IGtjYi5ib2FyZE1hbmFnZXIuZ2V0KHBvaW50LmluZGV4KTtcbiAgICAgICAga2NiLm1vdmUoY2VsbC5wb2ludC5pbmRleCwgdGFyZ2V0Q2VsbC5wb2ludC5pbmRleCk7XG4gICAgICAgIGNvbnN0IG1vdmVkQ2VsbHMgPSBrY2IuYm9hcmRNYW5hZ2VyLm1vdmVkQ2VsbHM7XG4gICAgICAgIGV4cGVjdChtb3ZlZENlbGxzWzFdLnBpZWNlKS50b0JlKHBpZWNlKTtcbiAgICB9KTtcbn0pO1xuXG4vKlxuICogQ29weXJpZ2h0IChjKSAyMDIxLCBLNHVzXG4gKiBBdXRob3I6IFJha3NhIEVuZyA8ZW5nLnJha3NhQGdtYWlsLmNvbT5cbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0XG4gKiBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMgYXJlIG1ldDpcbiAqXG4gKiAxLiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsXG4gKiAgICB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyLlxuICogMi4gUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLFxuICogICAgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGUgZG9jdW1lbnRhdGlvblxuICogICAgYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uXG4gKlxuICogVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCBCWSBUSEUgQ09QWVJJR0hUIEhPTERFUlMgQU5EIENPTlRSSUJVVE9SUyAnQVMgSVMnXG4gKiBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFXG4gKiBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRVxuICogQVJFIERJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBDT1BZUklHSFQgT1dORVIgT1IgQ09OVFJJQlVUT1JTIEJFXG4gKiBMSUFCTEUgRk9SIEFOWSBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SXG4gKiBDT05TRVFVRU5USUFMIERBTUFHRVMgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRlxuICogU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUzsgTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTXG4gKiBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORCBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTlxuICogQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlQgKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSlcbiAqIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFXG4gKiBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS5cbiAqXG4gKiovIl19