"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = drawBoardAndGraveyard;

var _khmerChess = require("khmer-chess");

var _CellManager = _interopRequireDefault(require("../CellManager"));

var _constance = require("../providers/constance");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

/*
 * Copyright (c) 2021, K4us
 * Author: Raksa Eng <eng.raksa@gmail.com>
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 *
 *---------------------------------------------------------------------------- */
function drawBoardAndGraveyard(_ref) {
  var uniqueClassName = _ref.uniqueClassName,
      options = _ref.options,
      container = _ref.container,
      boardManager = _ref.boardManager,
      graveyardManager = _ref.graveyardManager;
  var width = options.width,
      cellWidth = options.cellWidth,
      graveyardContainerHeight = options.graveyardContainerHeight,
      graveyardWidth = options.graveyardWidth,
      graveyardContainerPadding = options.graveyardContainerPadding;

  var createTable = function createTable() {
    var parent = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : container;
    var table = document.createElement('table');
    parent.appendChild(table);
    return table;
  };

  var createTbody = function createTbody(parent) {
    var tbody = document.createElement('tbody');
    parent.appendChild(tbody);
    return tbody;
  };

  var createTr = function createTr(parent) {
    var tr = document.createElement('tr');
    parent.appendChild(tr);
    return tr;
  };

  var createTd = function createTd(parent) {
    var td = document.createElement('td');
    parent.appendChild(td);
    return td;
  };

  var table = createTable();
  table.classList.add(_constance.TABLE_CLASS);
  table.classList.add(uniqueClassName);
  var tbody = createTbody(table);

  for (var i = 0; i < _khmerChess.ROW_NUMBER; i++) {
    var _tr = createTr(tbody);

    _tr.classList.add(_constance.TR_PIECE_CLASS_NAME);

    for (var j = 0; j < _khmerChess.ROW_NUMBER; j++) {
      var td = createTd(_tr);
      var cellPiece = new _CellManager["default"](new _khmerChess.Point(j, _khmerChess.ROW_NUMBER - i - 1), td, null);

      var index = _khmerChess.Point.xyToIndex(j, _khmerChess.ROW_NUMBER - i - 1);

      boardManager.put(index, cellPiece);
    }
  }

  var tr = createTr(tbody);
  tr.classList.add(_constance.TR_PIECE_SHADOW_CLASS_NAME);
  var tdShadow = createTd(tr);
  var trPlayerContainer = createTr(tbody);
  trPlayerContainer.classList.add('tr-player');
  trPlayerContainer.style.height = "".concat(graveyardContainerHeight / 3);
  var tdPlayerContainer = createTd(trPlayerContainer);
  tdPlayerContainer.classList.add('player');
  tdPlayerContainer.addEventListener('mousewheel', function (e) {
    this.scrollLeft -= e.wheelDelta;
    e.preventDefault();
  }, false);
  tdPlayerContainer.colSpan = 8;
  var trGraveyardContainer = createTr(tbody);
  trGraveyardContainer.classList.add('tr-graveyard');
  trGraveyardContainer.style.height = "".concat(graveyardContainerHeight);
  var tdGraveyardContainer = createTd(trGraveyardContainer);
  tdGraveyardContainer.classList.add('graveyard');
  tdGraveyardContainer.addEventListener('mousewheel', function (e) {
    this.scrollLeft -= e.wheelDelta;
    e.preventDefault();
  }, false);
  tdGraveyardContainer.colSpan = 8;
  var div = document.createElement('div');
  div.style.overflowX = 'scroll';
  div.style.overflowY = 'hidden';
  tdGraveyardContainer.appendChild(div);
  var tableGraveyard = createTable(div);
  tableGraveyard.classList.add(_constance.GRAVEYARD_CLASS_NAME);
  tableGraveyard.style.width = "".concat(graveyardWidth);
  tableGraveyard.style.height = "".concat(cellWidth);
  tableGraveyard.style.boxShadow = "inset 0 0 ".concat(width / 60, "px #000000");
  var tbodyGraveyard = createTbody(tableGraveyard);
  var trGraveyard = createTr(tbodyGraveyard);
  trGraveyard.classList.add(_constance.TR_PIECE_CLASS_NAME);
  trGraveyard.style.width = "".concat(graveyardWidth);

  for (var _i = 0; _i < _constance.TD_GRAVEYARD_NUMBER; _i++) {
    var tdGraveyard = createTd(trGraveyard);

    var _cellPiece = new _CellManager["default"](new _khmerChess.Point(_i, 0), tdGraveyard, null, true);

    graveyardManager.push(_cellPiece);
  }

  return {
    domBoard: table,
    domGraveyard: tableGraveyard,
    playerContainer: tdPlayerContainer,
    tdShadow: tdShadow
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9oZWxwZXJzL2RyYXdCb2FyZEFuZEdyYXZleWFyZC50cyJdLCJuYW1lcyI6WyJkcmF3Qm9hcmRBbmRHcmF2ZXlhcmQiLCJ1bmlxdWVDbGFzc05hbWUiLCJvcHRpb25zIiwiY29udGFpbmVyIiwiYm9hcmRNYW5hZ2VyIiwiZ3JhdmV5YXJkTWFuYWdlciIsIndpZHRoIiwiY2VsbFdpZHRoIiwiZ3JhdmV5YXJkQ29udGFpbmVySGVpZ2h0IiwiZ3JhdmV5YXJkV2lkdGgiLCJncmF2ZXlhcmRDb250YWluZXJQYWRkaW5nIiwiY3JlYXRlVGFibGUiLCJwYXJlbnQiLCJ0YWJsZSIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImFwcGVuZENoaWxkIiwiY3JlYXRlVGJvZHkiLCJ0Ym9keSIsImNyZWF0ZVRyIiwidHIiLCJjcmVhdGVUZCIsInRkIiwiY2xhc3NMaXN0IiwiYWRkIiwiVEFCTEVfQ0xBU1MiLCJpIiwiUk9XX05VTUJFUiIsIlRSX1BJRUNFX0NMQVNTX05BTUUiLCJqIiwiY2VsbFBpZWNlIiwiQ2VsbE1hbmFnZXIiLCJQb2ludCIsImluZGV4IiwieHlUb0luZGV4IiwicHV0IiwiVFJfUElFQ0VfU0hBRE9XX0NMQVNTX05BTUUiLCJ0ZFNoYWRvdyIsInRyUGxheWVyQ29udGFpbmVyIiwic3R5bGUiLCJoZWlnaHQiLCJ0ZFBsYXllckNvbnRhaW5lciIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwic2Nyb2xsTGVmdCIsIndoZWVsRGVsdGEiLCJwcmV2ZW50RGVmYXVsdCIsImNvbFNwYW4iLCJ0ckdyYXZleWFyZENvbnRhaW5lciIsInRkR3JhdmV5YXJkQ29udGFpbmVyIiwiZGl2Iiwib3ZlcmZsb3dYIiwib3ZlcmZsb3dZIiwidGFibGVHcmF2ZXlhcmQiLCJHUkFWRVlBUkRfQ0xBU1NfTkFNRSIsImJveFNoYWRvdyIsInRib2R5R3JhdmV5YXJkIiwidHJHcmF2ZXlhcmQiLCJURF9HUkFWRVlBUkRfTlVNQkVSIiwidGRHcmF2ZXlhcmQiLCJw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QWpDO0FBQ0E4QyxFQUFBQSxjQUFjLENBQUNkLEtBQWYsQ0FBcUJnQixTQUFyQix1QkFBOENqRCxLQUFLLEdBQUcsRUFBdEQ7QUFFQSxNQUFNa0QsY0FBYyxHQUFHdkMsV0FBVyxDQUFDb0MsY0FBRCxDQUFsQztBQUNBLE1BQU1JLFdBQVcsR0FBR3RDLFFBQVEsQ0FBQ3FDLGNBQUQsQ0FBNUI7QUFDQUMsRUFBQUEsV0FBVyxDQUFDbEMsU0FBWixDQUFzQkMsR0FBdEIsQ0FBMEJJLDhCQUExQjtBQUNBNkIsRUFBQUEsV0FBVyxDQUFDbEIsS0FBWixDQUFrQmpDLEtBQWxCLGFBQTZCRyxjQUE3Qjs7QUFFQSxPQUFLLElBQUlpQixFQUFDLEdBQUcsQ0FBYixFQUFnQkEsRUFBQyxHQUFHZ0MsOEJBQXBCLEVBQXlDaEMsRUFBQyxFQUExQyxFQUE4QztBQUMxQyxRQUFNaUMsV0FBVyxHQUFHdEMsUUFBUSxDQUFDb0MsV0FBRCxDQUE1Qjs7QUFDQSxRQUFNM0IsVUFBUyxHQUFHLElBQUlDLHVCQUFKLENBQWdCLElBQUlDLGlCQUFKLENBQVVOLEVBQVYsRUFBYSxDQUFiLENBQWhCLEVBQWlDaUMsV0FBakMsRUFBOEMsSUFBOUMsRUFBb0QsSUFBcEQsQ0FBbEI7O0FBQ0F0RCxJQUFBQSxnQkFBZ0IsQ0FBQ3VELElBQWpCLENBQXNCOUIsVUFBdEI7QUFDSDs7QUFFRCxTQUFPO0FBQ0grQixJQUFBQSxRQUFRLEVBQUVoRCxLQURQO0FBRUhpRCxJQUFBQSxZQUFZLEVBQUVULGNBRlg7QUFHSFUsSUFBQUEsZUFBZSxFQUFFdEIsaUJBSGQ7QUFJSEosSUFBQUEsUUFBUSxFQUFSQTtBQUpHLEdBQVA7QUFNSCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCb2FyZE1hbmFnZXIgZnJvbSAnLi4vQm9hcmRNYW5hZ2VyJztcbmltcG9ydCBHcmF2ZXlhcmRNYW5hZ2VyIGZyb20gJy4uL0dyYXZleWFyZE1hbmFnZXInO1xuaW1wb3J0IE9wdGlvbnNNYW5hZ2VyIGZyb20gJy4uL09wdGlvbnNNYW5hZ2VyJztcblxuLypcbiAqIENvcHlyaWdodCAoYykgMjAyMSwgSzR1c1xuICogQXV0aG9yOiBSYWtzYSBFbmcgPGVuZy5yYWtzYUBnbWFpbC5jb20+XG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dFxuICogbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6XG4gKlxuICogMS4gUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLFxuICogICAgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci5cbiAqIDIuIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSxcbiAqICAgIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlIGRvY3VtZW50YXRpb25cbiAqICAgIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLlxuICpcbiAqIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgXCJBUyBJU1wiXG4gKiBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFXG4gKiBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRVxuICogQVJFIERJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBDT1BZUklHSFQgT1dORVIgT1IgQ09OVFJJQlVUT1JTIEJFXG4gKiBMSUFCTEUgRk9SIEFOWSBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SXG4gKiBDT05TRVFVRU5USUFMIERBTUFHRVMgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRlxuICogU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUzsgTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTXG4gKiBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORCBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTlxuICogQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlQgKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSlcbiAqIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFXG4gKiBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS5cbiAqXG4gKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cbmltcG9ydCB7XG4gICAgUG9pbnQsXG4gICAgUk9XX05VTUJFUixcbn0gZnJvbSAna2htZXItY2hlc3MnO1xuaW1wb3J0IENlbGxNYW5hZ2VyIGZyb20gJy4uL0NlbGxNYW5hZ2VyJztcbmltcG9ydCB7XG4gICAgVERfR1JBVkVZQVJEX05VTUJFUixcbiAgICBUQUJMRV9DTEFTUyxcbiAgICBHUkFWRVlBUkRfQ0xBU1NfTkFNRSxcbiAgICBUUl9QSUVDRV9DTEFTU19OQU1FLFxuICAgIFRSX1BJRUNFX1NIQURPV19DTEFTU19OQU1FLFxufSBmcm9tICcuLi9wcm92aWRlcnMvY29uc3RhbmNlJztcblxudHlwZSBUeXBlID0ge1xuICAgIHVuaXF1ZUNsYXNzTmFtZTogc3RyaW5nO1xuICAgIG9wdGlvbnM6IE9wdGlvbnNNYW5hZ2VyO1xuICAgIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG4gICAgYm9hcmRNYW5hZ2VyOiBCb2FyZE1hbmFnZXI7XG4gICAgZ3JhdmV5YXJkTWFuYWdlcjogR3JhdmV5YXJkTWFuYWdlcjtcbn07XG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBkcmF3Qm9hcmRBbmRHcmF2ZXlhcmQoe1xuICAgIHVuaXF1ZUNsYXNzTmFtZSwgb3B0aW9ucywgY29udGFpbmVyLCBib2FyZE1hbmFnZXIsIGdyYXZleWFyZE1hbmFnZXIgfTogVHlwZSkge1xuICAgIGNvbnN0IHtcbiAgICAgICAgd2lkdGgsXG4gICAgICAgIGNlbGxXaWR0aCxcbiAgICAgICAgZ3JhdmV5YXJkQ29udGFpbmVySGVpZ2h0LFxuICAgICAgICBncmF2ZXlhcmRXaWR0aCxcbiAgICAgICAgZ3JhdmV5YXJkQ29udGFpbmVyUGFkZGluZyxcbiAgICB9ID0gb3B0aW9ucztcblxuICAgIGNvbnN0IGNyZWF0ZVRhYmxlID0gKHBhcmVudCA9IGNvbnRhaW5lcikgPT4ge1xuICAgICAgICBjb25zdCB0YWJsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RhYmxlJyk7XG4gICAgICAgIHBhcmVudC5hcHBlbmRDaGlsZCh0YWJsZSk7XG4gICAgICAgIHJldHVybiB0YWJsZTtcbiAgICB9O1xuICAgIGNvbnN0IGNyZWF0ZVRib2R5ID0gKHBhcmVudDogSFRNTFRhYmxlRWxlbWVudCkgPT4ge1xuICAgICAgICBjb25zdCB0Ym9keSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3Rib2R5Jyk7XG4gICAgICAgIHBhcmVudC5hcHBlbmRDaGlsZCh0Ym9keSk7XG4gICAgICAgIHJldHVybiB0Ym9keTtcbiAgICB9O1xuICAgIGNvbnN0IGNyZWF0ZVRyID0gKHBhcmVudDogSFRNTFRhYmxlU2VjdGlvbkVsZW1lbnQpID0+IHtcbiAgICAgICAgY29uc3QgdHIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xuICAgICAgICBwYXJlbnQuYXBwZW5kQ2hpbGQodHIpO1xuICAgICAgICByZXR1cm4gdHI7XG4gICAgfTtcbiAgICBjb25zdCBjcmVhdGVUZCA9IChwYXJlbnQ6IEhUTUxUYWJsZVJvd0VsZW1lbnQpID0+IHtcbiAgICAgICAgY29uc3QgdGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgICAgICBwYXJlbnQuYXBwZW5kQ2hpbGQodGQpO1xuICAgICAgICByZXR1cm4gdGQ7XG4gICAgfTtcblxuICAgIGNvbnN0IHRhYmxlID0gY3JlYXRlVGFibGUoKTtcbiAgICB0YWJsZS5jbGFzc0xpc3QuYWRkKFRBQkxFX0NMQVNTKTtcbiAgICB0YWJsZS5jbGFzc0xpc3QuYWRkKHVuaXF1ZUNsYXNzTmFtZSk7XG4gICAgY29uc3QgdGJvZHkgPSBjcmVhdGVUYm9keSh0YWJsZSk7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IFJPV19OVU1CRVI7IGkrKykge1xuICAgICAgICBjb25zdCB0ciA9IGNyZWF0ZVRyKHRib2R5KTtcbiAgICAgICAgdHIuY2xhc3NMaXN0LmFkZChUUl9QSUVDRV9DTEFTU19OQU1FKTtcbiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBST1dfTlVNQkVSOyBqKyspIHtcbiAgICAgICAgICAgIGNvbnN0IHRkID0gY3JlYXRlVGQodHIpO1xuICAgICAgICAgICAgY29uc3QgY2VsbFBpZWNlID0gbmV3IENlbGxNYW5hZ2VyKG5ldyBQb2ludChqLCBST1dfTlVNQkVSIC0gaSAtIDEpLCB0ZCwgbnVsbCk7XG4gICAgICAgICAgICBjb25zdCBpbmRleCA9IFBvaW50Lnh5VG9JbmRleChqLCBST1dfTlVNQkVSIC0gaSAtIDEpO1xuICAgICAgICAgICAgYm9hcmRNYW5hZ2VyLnB1dChpbmRleCwgY2VsbFBpZWNlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb25zdCB0ciA9IGNyZWF0ZVRyKHRib2R5KTtcbiAgICB0ci5jbGFzc0xpc3QuYWRkKFRSX1BJRUNFX1NIQURPV19DTEFTU19OQU1FKTtcbiAgICBjb25zdCB0ZFNoYWRvdyA9IGNyZWF0ZVRkKHRyKTtcblxuICAgIGNvbnN0IHRyUGxheWVyQ29udGFpbmVyID0gY3JlYXRlVHIodGJvZHkpO1xuICAgIHRyUGxheWVyQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ3RyLXBsYXllcicpO1xuICAgIHRyUGxheWVyQ29udGFpbmVyLnN0eWxlLmhlaWdodCA9IGAke2dyYXZleWFyZENvbnRhaW5lckhlaWdodCAvIDN9YDtcblxuICAgIGNvbnN0IHRkUGxheWVyQ29udGFpbmVyID0gY3JlYXRlVGQodHJQbGF5ZXJDb250YWluZXIpO1xuICAgIHRkUGxheWVyQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ3BsYXllcicpO1xuICAgIHRkUGxheWVyQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNld2hlZWwnLCBmdW5jdGlvbiAoZTogYW55KSB7XG4gICAgICAgIHRoaXMuc2Nyb2xsTGVmdCAtPSAoZS53aGVlbERlbHRhKTtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH0sIGZhbHNlKTtcbiAgICB0ZFBsYXllckNvbnRhaW5lci5jb2xTcGFuID0gODtcblxuICAgIGNvbnN0IHRyR3JhdmV5YXJkQ29udGFpbmVyID0gY3JlYXRlVHIodGJvZHkpO1xuICAgIHRyR3JhdmV5YXJkQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ3RyLWdyYXZleWFyZCcpO1xuICAgIHRyR3JhdmV5YXJkQ29udGFpbmVyLnN0eWxlLmhlaWdodCA9IGAke2dyYXZleWFyZENvbnRhaW5lckhlaWdodH1gO1xuXG4gICAgY29uc3QgdGRHcmF2ZXlhcmRDb250YWluZXIgPSBjcmVhdGVUZCh0ckdyYXZleWFyZENvbnRhaW5lcik7XG4gICAgdGRHcmF2ZXlhcmRDb250YWluZXIuY2xhc3NMaXN0LmFkZCgnZ3JhdmV5YXJkJyk7XG4gICAgdGRHcmF2ZXlhcmRDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V3aGVlbCcsIGZ1bmN0aW9uIChlOiBhbnkpIHtcbiAgICAgICAgdGhpcy5zY3JvbGxMZWZ0IC09IChlLndoZWVsRGVsdGEpO1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfSwgZmFsc2UpO1xuICAgIHRkR3JhdmV5YXJkQ29udGFpbmVyLmNvbFNwYW4gPSA4O1xuXG4gICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgZGl2LnN0eWxlLm92ZXJmbG93WCA9ICdzY3JvbGwnO1xuICAgIGRpdi5zdHlsZS5vdmVyZmxvd1kgPSAnaGlkZGVuJztcblxuICAgIHRkR3JhdmV5YXJkQ29udGFpbmVyLmFwcGVuZENoaWxkKGRpdik7XG4gICAgY29uc3QgdGFibGVHcmF2ZXlhcmQgPSBjcmVhdGVUYWJsZShkaXYpO1xuICAgIHRhYmxlR3JhdmV5YXJkLmNsYXNzTGlzdC5hZGQoR1JBVkVZQVJEX0NMQVNTX05BTUUpO1xuICAgIHRhYmxlR3JhdmV5YXJkLnN0eWxlLndpZHRoID0gYCR7Z3JhdmV5YXJkV2lkdGh9YDtcbiAgICB0YWJsZUdyYXZleWFyZC5zdHlsZS5oZWlnaHQgPSBgJHtjZWxsV2lkdGh9YDtcbiAgICB0YWJsZUdyYXZleWFyZC5zdHlsZS5ib3hTaGFkb3cgPSBgaW5zZXQgMCAwICR7d2lkdGggLyA2MH1weCAjMDAwMDAwYDtcblxuICAgIGNvbnN0IHRib2R5R3JhdmV5YXJkID0gY3JlYXRlVGJvZHkodGFibGVHcmF2ZXlhcmQpO1xuICAgIGNvbnN0IHRyR3JhdmV5YXJkID0gY3JlYXRlVHIodGJvZHlHcmF2ZXlhcmQpO1xuICAgIHRyR3JhdmV5YXJkLmNsYXNzTGlzdC5hZGQoVFJfUElFQ0VfQ0xBU1NfTkFNRSk7XG4gICAgdHJHcmF2ZXlhcmQuc3R5bGUud2lkdGggPSBgJHtncmF2ZXlhcmRXaWR0aH1gO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBURF9HUkFWRVlBUkRfTlVNQkVSOyBpKyspIHtcbiAgICAgICAgY29uc3QgdGRHcmF2ZXlhcmQgPSBjcmVhdGVUZCh0ckdyYXZleWFyZCk7XG4gICAgICAgIGNvbnN0IGNlbGxQaWVjZSA9IG5ldyBDZWxsTWFuYWdlcihuZXcgUG9pbnQoaSwgMCksIHRkR3JhdmV5YXJkLCBudWxsLCB0cnVlKTtcbiAgICAgICAgZ3JhdmV5YXJkTWFuYWdlci5wdXNoKGNlbGxQaWVjZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgZG9tQm9hcmQ6IHRhYmxlLFxuICAgICAgICBkb21HcmF2ZXlhcmQ6IHRhYmxlR3JhdmV5YXJkLFxuICAgICAgICBwbGF5ZXJDb250YWluZXI6IHRkUGxheWVyQ29udGFpbmVyLFxuICAgICAgICB0ZFNoYWRvdyxcbiAgICB9O1xufVxuIl19